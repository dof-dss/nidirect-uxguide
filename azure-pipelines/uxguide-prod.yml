trigger:
  branches:
    include:
      - main

steps:  

- task: AzureCLI@2
  displayName: 'Upload static site to Azure Storage ($web)'
  inputs:
    azureSubscription: 'EDD-General-Prod'
    scriptType: 'bash'
    scriptLocation: 'inlineScript'
    inlineScript: |
      set -euo pipefail

      STORAGE_ACCOUNT_NAME="uxguide2"
      SOURCE_FOLDER="."  # deploying from root

      echo "Enabling static website..."
      az storage blob service-properties update \
        --account-name "$STORAGE_ACCOUNT_NAME" \
        --static-website \
        --index-document index.html \
        --404-document 404.html

      echo "Uploading contents of '$SOURCE_FOLDER' to \$web (excluding .json files and node_modules)..."
      az storage blob upload-batch \
        --account-name "$STORAGE_ACCOUNT_NAME" \
        --destination '$web' \
        --source "$SOURCE_FOLDER" \
        --overwrite true \
        --exclude "*.json" \
        --exclude "node_modules/*" \
        --exclude "node_modules/**/*"

      echo "âœ… Upload complete."