trigger:
  branches:
    include:
      - main

pool:
  vmImage: 'ubuntu-latest'

steps:
  # Optional: install dependencies & build (remove if not needed)
  - task: NodeTool@0
    inputs:
      versionSpec: '18.x'
    displayName: 'Use Node.js 18'

  - script: |
      npm install
      npm run build
    displayName: 'Build project'

  # Deploy static site content to Azure Storage $web
  - task: AzureCLI@2
    displayName: 'Upload to Azure Storage Static Site ($web)'
    inputs:
      azureSubscription: 'EDD-General-Prod'   # Service connection
      scriptType: 'bash'
      scriptLocation: 'inlineScript'
      inlineScript: |
        # Variables
        STORAGE_ACCOUNT_NAME=uxguide2
        SOURCE_FOLDER="."

        echo "Uploading files to Azure Storage static site..."

        # Enable static site hosting (safe to run even if already enabled)
        az storage blob service-properties update \
          --account-name $STORAGE_ACCOUNT_NAME \
          --static-website \
          --index-document index.html \
          --404-document 404.html

        # Upload files to $web container
        az storage blob upload-batch \
          --account-name $STORAGE_ACCOUNT_NAME \
          --destination '$web' \
          --source $SOURCE_FOLDER \
          --overwrite true

        echo "Deployment complete."